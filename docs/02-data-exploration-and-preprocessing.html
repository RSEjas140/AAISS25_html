<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>AISS25: Data exploration and Preprocessing</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/swc/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicons/swc/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicons/swc/favicon-16x16.png"><link rel="manifest" href="favicons/swc/site.webmanifest"><link rel="mask-icon" href="favicons/swc/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav software"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="swc-logo" alt="Aberystwyth AI Summer School 2025" src="assets/images/software-logo.svg"><span class="badge text-bg-warning">
          <abbr title="This lesson is in the alpha phase, which means that it has been taught once and lesson authors are iterating on feedback.">
            <a href="https://docs.carpentries.org/resources/curriculum/lesson-life-cycle.html" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-triangle" style="border-radius: 5px"></i>
              Alpha
            </a>
            <span class="visually-hidden">This lesson is in the alpha phase, which means that it has been taught once and lesson authors are iterating on feedback.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/02-data-exploration-and-preprocessing.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav software" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Aberystwyth AI Summer School 2025" src="assets/images/software-logo-sm.svg"></div>
    <div class="lesson-title-md">
      AISS25
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            AISS25
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  AISS25
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 0%" class="percentage">
    0%
  </div>
  <div class="progress software">
    <div class="progress-bar software" role="progressbar" style="width: 0%" aria-valuenow="0" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/02-data-exploration-and-preprocessing.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="00-worked-example.html">1. Working Example</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="01-problem-definition.html">2. Problem Definition</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        3. Data exploration and Preprocessing
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#introduction">Introduction</a></li>
<li><a href="#use-dataframe.dtypes-to-show-the-datatypes-of-each-column">Use <code>DataFrame.dtypes</code> to show the datatypes of each
column</a></li>
<li><a href="#select-a-value-by-its-index-label-using-loc">Select a value by its index label using <code>loc[]</code></a></li>
<li><a href="#select-a-column-from-a-dataframe-with-column-name">Select a column from a DataFrame with
<code>["Column name"]</code></a></li>
<li><a href="#cast-a-column-to-a-different-data-type-with-astype">Cast a column to a different data type with
<code>astype()</code></a></li>
<li><a href="#find-missing-values-with-isna">Find missing values with <code>isna()</code></a></li>
<li><a href="#use-fillna-to-fill-missing-values-in-a-column">Use <code>fillna()</code> to fill missing values in a column</a></li>
<li><a href="#use-dropna-on-a-dataframe-to-remove-rows-or-columns-with-missing-values">Use <code>dropna()</code> on a DataFrame to remove rows or columns
with missing values</a></li>
<li><a href="#use-value_counts-to-count-occurrences-of-categorical-variables">Use <code>value_counts</code> to count occurrences of categorical
variables</a></li>
<li><a href="#use-loc-with-boolean-masking-to-select-values-according-to-logical-rules">Use <code>loc[]</code> with boolean masking to select values
according to logical rules</a></li>
<li><a href="#pandas-can-run-str-functions-on-string-columns">Pandas can run <code>str</code> functions on string columns</a></li>
<li><a href="#check-which-values-occur-in-a-series-with-isin">Check which values occur in a Series with <code>isin()</code></a></li>
<li><a href="#use-map-to-efficiently-apply-a-function-to-every-element">Use <code>map()</code> to efficiently apply a function to every
element</a></li>
<li><a href="#remove-duplicate-values-with-drop_duplicates-or-duplicated">Remove duplicate values with <code>drop_duplicates()</code> or
<code>duplicated()</code></a></li>
<li><a href="#remove-outliers">Remove outliers</a></li>
<li><a href="#compare-salaries-by-country-using-groupby">Compare salaries by country using <code>groupby()</code></a></li>
<li><a href="#use-groupby-to-perform-calculations-on-groups-of-data">Use <code>groupby()</code> to perform calculations on groups of
data</a></li>
<li><a href="#use-ordinalencoder-for-features-that-have-an-implicit-order">Use <code>OrdinalEncoder()</code> for features that have an implicit
order</a></li>
<li><a href="#calculate-correlations-with-dataframe.corr">Calculate correlations with <code>DataFrame.corr()</code></a></li>
<li><a href="#use-pca-to-visualise-more-complex-structures">Use PCA to visualise more complex structures</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-model-selection.html">4. Machine learning: Model Selection</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="01-problem-definition.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="04-model-selection.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="01-problem-definition.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Problem Definition
        </a>
        <a class="chapter-link float-end" href="04-model-selection.html" rel="next">
          Next: Machine learning:...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Data exploration and Preprocessing</h1>
        <p>Last updated on 2025-07-08 |

        <a href="https://github.com/RSEjas140/AAISS25_html/edit/main/episodes/02-data-exploration-and-preprocessing.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How can I read in data to Pandas?</li>
<li>How can I access specific sections of my data?</li>
<li>How does Pandas store data in rows and columns?</li>
<li>How can I clean up messy data?</li>
<li>How can I learn more about missing values, distributions and
structures in my data?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Know the difference between a Series and a Dataframe</li>
<li>Know how to use <code>loc[]</code> to access data</li>
<li>Know how to apply basic data cleaning operations</li>
<li>Know how to use some more sophisticated Pandas functions to explore
and manipulate data</li>
<li>Know some techniques for preparing your data for machine
learning</li>
</ul></div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a></h2>
<hr class="half-width"><p>You’ve seen briefly how to use Pandas to read in a data file when we
looked at the Penguin data. Real-world datasets are often - usually -
nearly always? - quite messy; so much so that data scientists spend the
majority of their time organising and cleaning data <a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>.</p>
<p>We’re going to work with a real dataset from an annual salary survey
from the website <a href="https://www.askamanager.org/2025/04/how-much-money-do-you-make-8.html" class="external-link">askamanager.org</a>.
Have a look at the website and browse the questions, then read in the <a href="data/AAM_salary_survey_2025_responses.csv">data file</a>.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co"># Read the raw salary-survey responses</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>survey_path <span class="op">=</span> <span class="st">"data/AAM_salary_survey_2025_responses.csv"</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>survey_data <span class="op">=</span> pd.read_csv(survey_path)</span></code></pre>
</div>
<p>A DataFrame contains labelled data. Each row and each column has a
label. The labels are stored in an index.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># print the column labels</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="bu">print</span>(survey_data.columns)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Index(['Timestamp', 'Age', 'Industry', 'Functional area of job', 'Job title',
       'Additional context', 'Annual salary',
       'Additional monetary compensation', 'Currency', 'Currency - other',
       'Income - additional context', 'Country', 'State', 'City/region',
       'Remote or on-site?', 'Unionized?', 'Years of experience',
       'Years in field', 'Highest level of education', 'Gender', 'Race',
       'Disabled?'],
      dtype='object')</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># Show the first few lines</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>survey_data.head()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>           Timestamp  ... Disabled?
0  4/8/2025 11:01:58  ...       Yes
1  4/8/2025 11:02:05  ...        No
2  4/8/2025 11:02:26  ...        No
3  4/8/2025 11:02:30  ...        No
4  4/8/2025 11:02:31  ...        No

[5 rows x 22 columns]</code></pre>
</div>
<p>A DataFrame can contain a mix of data types.</p>
<p>We can see that there’s lots of interesting data in there. Here’s a
small list of questions we might want to ask: - What’s the distribution
of total income across all jobs? - Do unionised jobs earn more or less
than non-unionised? - Does salary go up with age, years of experience,
and education level? - Do people earning additional income tend to have
higher base salaries?</p>
<p>We’ll work through these, learning some more Pandas and data
manipulation skills along the way.</p>
</section><section><h2 class="section-heading" id="use-dataframe-dtypes-to-show-the-datatypes-of-each-column">Use <code>DataFrame.dtypes</code> to show the datatypes of each
column<a class="anchor" aria-label="anchor" href="#use-dataframe-dtypes-to-show-the-datatypes-of-each-column"></a></h2>
<hr class="half-width"><p>Each column in a DataFrame is a Series. Series contain labelled data
too, but a Series can only contain a single data type.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># List the column headings and their inferred dtypes</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>survey_data.dtypes</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Timestamp                            object
Age                                  object
Industry                             object
Functional area of job               object
Job title                            object
Additional context                   object
Annual salary                         int64
Additional monetary compensation    float64
Currency                             object
Currency - other                     object
Income - additional context          object
Country                              object
State                                object
City/region                          object
Remote or on-site?                   object
Unionized?                           object
Years of experience                  object
Years in field                       object
Highest level of education           object
Gender                               object
Race                                 object
Disabled?                            object
dtype: object</code></pre>
</div>
<p>Pandas will try to work out what this should be, but sometimes does a
bad job. When it has a mixture of strings and numbers, it picks the most
generic type possible, which is <code>object</code>.</p>
</section><section><h2 class="section-heading" id="select-a-value-by-its-index-label-using-loc">Select a value by its index label using <code>loc[]</code>
<a class="anchor" aria-label="anchor" href="#select-a-value-by-its-index-label-using-loc"></a></h2>
<hr class="half-width"><p>Note that the list of datatypes above is itself a Series! The index
labels are the column headings from <code>survey_results</code>, and the
values are the data types. We can pull out a single value with a label
from this series using the function <code>loc[]</code></p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>survey_data.dtypes.loc[<span class="st">"Age"</span>]</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fu">dtype</span><span class="op">(</span><span class="st">'O'</span><span class="op">)</span></span></code></pre>
</div>
<p>Notice the square brackets!</p>
<div id="callout1" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>The <code>loc[]</code> function is really useful, and confusing, and
we’ll see more of it later. For now, remember that it takes square
brackets, and it lets you access data by its <em>label</em>.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="select-a-column-from-a-dataframe-with-column-name">Select a column from a DataFrame with
<code>["Column name"]</code>
<a class="anchor" aria-label="anchor" href="#select-a-column-from-a-dataframe-with-column-name"></a></h2>
<hr class="half-width"><p>You can select a column with square brackets containing the column
name.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>survey_data[<span class="st">"Industry"</span>]</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>0                                Nonprofits
1                               Health Care
2                               Engineering
3                                Nonprofits
4              Education (Higher Education)
                       ...
8229                                 Retail
8230     Government &amp; Public Administration
8231     Government &amp; Public Administration
8232    Education (Early/Primary/Secondary)
8233           Education (Higher Education)
Name: Industry, Length: 8234, dtype: object</code></pre>
</div>
<p>This is really a shortcut for</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>survey_data.loc[:, <span class="st">"Industry"</span>]</span></code></pre>
</div>
<p>Used on a DataFrame, <code>loc[]</code> takes two arguments - the
first one is the rows you want and the second one is the columns. Just
like with lists, you can slice with <code>start:stop</code>, and missing
out either one uses the endpoints.</p>
</section><section><h2 class="section-heading" id="cast-a-column-to-a-different-data-type-with-astype">Cast a column to a different data type with
<code>astype()</code>
<a class="anchor" aria-label="anchor" href="#cast-a-column-to-a-different-data-type-with-astype"></a></h2>
<hr class="half-width"><p>You can change the data type of a column by selecting the column and
calling <code>astype()</code>, with the desired type as an argument.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>survey_data[<span class="st">"Industry"</span>].astype(<span class="st">"string"</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>0                                Nonprofits
1                               Health Care
2                               Engineering
3                                Nonprofits
4              Education (Higher Education)
                       ...
8229                                 Retail
8230     Government &amp; Public Administration
8231     Government &amp; Public Administration
8232    Education (Early/Primary/Secondary)
8233           Education (Higher Education)
Name: Industry, Length: 8234, dtype: string</code></pre>
</div>
<p>This doesn’t modify the original, it makes a copy, so we haven’t yet
saved the result. What if we want to change the data types of all the
columns that contain <code>objects</code> to strings? (I have a hunch
this might come in handy later…) We <em>could</em> do this manually, but
I’m lazy, so let’s get the computer do the work.</p>
<p>You can change multiple columns at once by calling
<code>astype()</code> on the DataFrame and passing in a dictionary that
maps column names to data types. Here’s one way to build this
dictionary:</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>dtypes_dict <span class="op">=</span> {}</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="co"># loop through the columns with dtype object and add them to a dictionary</span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="cf">for</span> column_name <span class="kw">in</span> survey_data.dtypes[survey_data.dtypes <span class="op">==</span> <span class="bu">object</span>].index:</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>  dtypes_dict[column_name] <span class="op">=</span> <span class="st">"string"</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>  </span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>dtypes_dict</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>{'Timestamp': 'string', 'Age': 'string', 'Industry': 'string', 'Functional area of job': 'string', 'Job title': 'string', 'Additional context': 'string', 'Currency': 'string', 'Currency - other': 'string', 'Income - additional context': 'string', 'Country': 'string', 'State': 'string', 'City/region': 'string', 'Remote or on-site?': 'string', 'Unionized?': 'string', 'Years of experience': 'string', 'Years in field': 'string', 'Highest level of education': 'string', 'Gender': 'string', 'Race': 'string', 'Disabled?': 'string'}</code></pre>
</div>
<p>Now let’s use that to set the data types in our DataFrame. Remember
that we need to save the results.</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>survey_data <span class="op">=</span> survey_data.astype(dtypes_dict)</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>survey_data.dtypes</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Timestamp                           string[python]
Age                                 string[python]
Industry                            string[python]
Functional area of job              string[python]
Job title                           string[python]
Additional context                  string[python]
Annual salary                                int64
Additional monetary compensation           float64
Currency                            string[python]
Currency - other                    string[python]
Income - additional context         string[python]
Country                             string[python]
State                               string[python]
City/region                         string[python]
Remote or on-site?                  string[python]
Unionized?                          string[python]
Years of experience                 string[python]
Years in field                      string[python]
Highest level of education          string[python]
Gender                              string[python]
Race                                string[python]
Disabled?                           string[python]
dtype: object</code></pre>
</div>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Describe the key variables in this survey: - Which columns are
<em>categorical</em> (nominal)? - Which are <em>ordinal</em> (have an
inherent order)? - Which are <em>numeric</em> (continuous or
discrete)?</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<p>Numeric: - Annual salary - Additional monetary compensation</p>
<p>Categorical: - Industry - Functional area of job - Job title - Remote
or on-site? - Country - State - City/region - Currency and Currency -
other</p>
<p>Ordinal: - Age - Years of experience - Years in field - Highest level
of education</p>
<p>Note that numeric variables that are grouped into bins are ordinal
when the bins are of different sizes!</p>
<p>Also highest level of education could be considered categorical,
because it’s not easy to sort every value.</p>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="find-missing-values-with-isna">Find missing values with <code>isna()</code>
<a class="anchor" aria-label="anchor" href="#find-missing-values-with-isna"></a></h2>
<hr class="half-width"><p>Do any of the columns have missing values? We can find them, count
them up in each column, and sort the results as follows:</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># Count missing values per column</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>survey_data.isna().<span class="bu">sum</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Currency - other                    8191
Income - additional context         7496
Additional context                  6402
Additional monetary compensation    2108
State                               1529
Race                                  91
Unionized?                            85
Functional area of job                65
Disabled?                             37
Industry                              34
Gender                                33
Remote or on-site?                    26
Highest level of education            16
City/region                            5
Job title                              1
Age                                    0
Timestamp                              0
Annual salary                          0
Country                                0
Currency                               0
Years in field                         0
Years of experience                    0
dtype: int64</code></pre>
</div>
<p>Lots of the columns have missing values - even some columns that are
required in the survey, like <code>Job title</code>. What’s doing on
here?</p>
<div id="callout2" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Pandas <code>read_csv()</code> function does a lot of work under the
hood. From the documentation:</p>
<blockquote>
<p>By default the following values are interpreted as NaN: “ “, “#N/A”,
“#N/A N/A”, “#NA”, “-1.#IND”, “-1.#QNAN”, “-NaN”, “-nan”, “1.#IND”,
“1.#QNAN”, “<na>”, “N/A”, “NA”, “NULL”, “NaN”, “None”, “n/a”, “nan”,
“null “.</na></p>
</blockquote>
</div>
</div>
</div>
<p>We also have the answer to our earlier question about the data type
of <code>Additional monetary compensation</code>. It contains
<code>NaN</code> values, which Pandas treats as a <code>float64</code>,
forcing the whole column to be float64.</p>
<div id="how-we-should-treat-missing-values-depends-on-the-analysis-we-want-to-do." class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="how-we-should-treat-missing-values-depends-on-the-analysis-we-want-to-do." class="callout-inner">
<h3 class="callout-title">How we should treat missing values depends on the analysis we want to do.</h3>
<div class="callout-content">

</div>
</div>
</div>
<p>How should we deal with the missing values? In some cases the missing
data is irrelevant. Each column needs to be considered differently. For
example: - we don’t need <code>Currency - other</code> if there is a
value in the <code>Currency</code> column - we don’t care about
<code>State</code> unless we’re only looking at the US - We can safely
assume that a missing value in
<code>Additional monetary compensation</code> means £0 - if we want to
know whether <code>Unionized?</code> makes a difference to earnings, a
row with no value there is useless to us</p>
<p>Pandas has some useful functions for this.</p>
</section><section><h2 class="section-heading" id="use-fillna-to-fill-missing-values-in-a-column">Use <code>fillna()</code> to fill missing values in a column<a class="anchor" aria-label="anchor" href="#use-fillna-to-fill-missing-values-in-a-column"></a></h2>
<hr class="half-width"><p>With <code>Additional monetary compensation</code> we can replace
missing values with 0. We can also change the type to be
<code>int64</code></p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>survey_data[<span class="st">"Additional monetary compensation"</span>] <span class="op">=</span> survey_data[<span class="st">"Additional monetary compensation"</span>].fillna(<span class="dv">0</span>).astype(<span class="st">"int"</span>)</span></code></pre>
</div>
</section><section><h2 class="section-heading" id="use-dropna-on-a-dataframe-to-remove-rows-or-columns-with-missing-values">Use <code>dropna()</code> on a DataFrame to remove rows or columns
with missing values<a class="anchor" aria-label="anchor" href="#use-dropna-on-a-dataframe-to-remove-rows-or-columns-with-missing-values"></a></h2>
<hr class="half-width"><div id="challenge2" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Pandas has a useful function, <code>dropna()</code>. Use the docs
pages (by running <code>help(survey_data.dropna)</code> or typing
<code>survey_data.drop_na(</code> and Shift+Tab) to find how to drop
rows that have missing values in the <code>Unionized?</code> column.</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>survey_data <span class="op">=</span> survey_data.dropna(subset<span class="op">=</span>[<span class="st">"Unionized?"</span>], axis<span class="op">=</span><span class="st">"rows"</span>)</span></code></pre>
</div>
<p>Note that <code>axis="rows"</code> (or <code>"index"</code>, or
<code>0</code>) is the default, so we don’t strictly need to include
it.</p>
</div>
</div>
</div>
</div>
<div id="callout4" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Does dropping <code>NA</code>s disproportionately affect any subgroup
(e.g., a particular country)? Consider whether that matters for your
analysis.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="use-value_counts-to-count-occurrences-of-categorical-variables">Use <code>value_counts</code> to count occurrences of categorical
variables<a class="anchor" aria-label="anchor" href="#use-value_counts-to-count-occurrences-of-categorical-variables"></a></h2>
<hr class="half-width"><p>Let’s get a sense of where the data is coming from. This is an
American website, in English, so the top results shouldn’t be a
surprise:</p>
<div class="codewrapper sourceCode" id="cb23">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>survey_data[<span class="st">"Country"</span>].value_counts().head()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Country
United States     6691
Canada             541
United Kingdom     444
Australia          141
Germany             68
Name: count, dtype: Int64</code></pre>
</div>
<p>What about the age column?</p>
<div class="codewrapper sourceCode" id="cb25">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>survey_data[<span class="st">"Age"</span>].value_counts()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Age
35-44         3403
25-34         2258
45-54         1597
55-64          711
18-24           88
65 or over      88
under 18         4
Name: count, dtype: Int64</code></pre>
</div>
<p>We want to know how income is distributed, but the income figures are
in different currencies, and some people have additional income on top
of their salaries, so we can’t compare directly. We’ll need to create a
new feature from our existing data. Let’s see what currencies we’ve
got.</p>
<div class="codewrapper sourceCode" id="cb27">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>survey_data[<span class="st">"Currency"</span>].value_counts()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Currency
USD      6722
CAD       541
GBP       442
EUR       192
AUD       139
NZD        51
Other      36
JPY         9
SEK         8
CHF         7
ZAR         2
Name: count, dtype: Int64</code></pre>
</div>
<p><code>Currency</code> uses three letter codes. We can work with that
to convert everyone’s earnings to the same currency using exchange rate
data.</p>
<p>But first, notice that we have 36 “Other”. Wouldn’t it be nice to see
what those are?</p>
</section><section><h2 class="section-heading" id="use-loc-with-boolean-masking-to-select-values-according-to-logical-rules">Use <code>loc[]</code> with boolean masking to select values
according to logical rules<a class="anchor" aria-label="anchor" href="#use-loc-with-boolean-masking-to-select-values-according-to-logical-rules"></a></h2>
<hr class="half-width"><p>As well as labels, we can use <code>loc[]</code> to access data based
on logical conditions. This is called boolean indexing or masking. First
we create a mask:</p>
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>survey_data[<span class="st">"Currency"</span>] <span class="op">==</span> <span class="st">"Other"</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>0       False
1       False
2       False
3       False
4       False
        ...
8229    False
8230    False
8231    False
8232    False
8233    False
Name: Currency, Length: 8149, dtype: boolean</code></pre>
</div>
<p>This is a Series of booleans with the same index as
<code>survey_data</code>, containing True where the
<code>Currency</code> column contains “Other” and False everywhere
else.</p>
<p>Then we pass that mask into <code>loc[]</code> to tell it which rows
we want:</p>
<div class="codewrapper sourceCode" id="cb31">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>survey_data.loc[survey_data[<span class="st">"Currency"</span>] <span class="op">==</span> <span class="st">"Other"</span>]</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>               Timestamp  ...                    Disabled?
545    4/8/2025 11:20:01  ...                           No
690    4/8/2025 11:24:17  ...                           No
985    4/8/2025 11:36:03  ...                           No
1210   4/8/2025 11:45:27  ...                           No
2369   4/8/2025 12:42:14  ...                           No
2513   4/8/2025 12:51:16  ...                           No
3704   4/8/2025 14:28:43  ...                           No
3975   4/8/2025 15:06:03  ...  Not sure / it's complicated
4701   4/8/2025 17:24:31  ...                           No
5377   4/8/2025 20:54:00  ...                           No
5414   4/8/2025 21:04:21  ...                           No
5643   4/8/2025 22:39:29  ...                           No
5860    4/9/2025 1:45:27  ...  Not sure / it's complicated
5902    4/9/2025 2:58:14  ...                           No
5905    4/9/2025 2:59:47  ...                           No
5918    4/9/2025 3:25:56  ...                           No
5979    4/9/2025 4:45:59  ...                           No
6009    4/9/2025 5:32:34  ...                           No
6083    4/9/2025 6:58:28  ...                           No
6253    4/9/2025 9:10:41  ...  Not sure / it's complicated
6320    4/9/2025 9:38:26  ...                          Yes
6348    4/9/2025 9:52:12  ...                           No
6431   4/9/2025 10:33:51  ...                           No
7117   4/9/2025 22:40:56  ...  Not sure / it's complicated
7155   4/10/2025 0:36:14  ...                           No
7168   4/10/2025 1:21:24  ...                           No
7198   4/10/2025 5:23:30  ...                           No
7289   4/10/2025 9:52:42  ...                           No
7366  4/10/2025 12:09:19  ...                           No
7390  4/10/2025 12:52:34  ...  Not sure / it's complicated
7689   4/12/2025 8:17:59  ...                           No
7805  4/14/2025 10:14:33  ...                           No
7965   4/17/2025 2:19:12  ...  Not sure / it's complicated
8001   4/18/2025 1:43:20  ...                           No
8080  4/25/2025 18:34:12  ...                           No
8186   5/14/2025 2:35:42  ...                           No

[36 rows x 22 columns]</code></pre>
</div>
<p>But we’re really only interested in one column -
<code>Currency - other</code>. We can pass that into <code>loc</code> as
well to just get a Series containing the elements of interest, and then
count the values like before:</p>
<div class="codewrapper sourceCode" id="cb33">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>survey_data.loc[survey_data[<span class="st">"Currency"</span>] <span class="op">==</span> <span class="st">"Other"</span>, <span class="st">"Currency - other"</span>].value_counts()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Currency - other
SGD                    6
NOK                    5
MXN                    2
Sek                    2
NZD                    2
AED                    2
PLN                    2
CZK                    2
TTD                    1
INR                    1
DKK (danish crowns)    1
BRL                    1
INR Indian Rupee       1
SEK                    1
DKK                    1
Sfr                    1
HUF                    1
KES                    1
MYR                    1
IDR                    1
Rupees                 1
Name: count, dtype: Int64</code></pre>
</div>
<p>There aren’t many of each - 6 Singaporean Dollars, 5 Norwegian
Kroners, 2 UAE Dirhams, etc. At this point we have to make a decision
about how much we care about this fairly small number of values. We
could decide it’s not worth the effort, but we’re going to be thorough
and clean up these values, even though it’s a bit fiddly, because it’s a
great chance to practice some more Pandas skills!</p>
<p>Let’s tidy up the <code>Currency</code> column. The three letter
codes in our <code>Currency - other</code> column look valid, so let’s
copy them straight over to <code>Currency</code>.</p>
<p>This is going to take a few steps: - find the rows where the length
of the <code>Currency - other</code> field is 3 - capitalise them, to
catch that pesky Swiss Franc (Sfr) - copy them to the
<code>Currency</code> column in the same rows</p>
</section><section><h2 class="section-heading" id="pandas-can-run-str-functions-on-string-columns">Pandas can run <code>str</code> functions on string columns<a class="anchor" aria-label="anchor" href="#pandas-can-run-str-functions-on-string-columns"></a></h2>
<hr class="half-width"><p>Finding the length of a string can be done efficiently with Pandas
<code>str</code> package. To make a Series containing all the
lengths:</p>
<div class="codewrapper sourceCode" id="cb35">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a>other_currency_len <span class="op">=</span> survey_data[<span class="st">"Currency - other"</span>].<span class="bu">str</span>.<span class="bu">len</span>()</span></code></pre>
</div>
<p>We can turn <code>curr_lengths</code> into a boolean mask like
this:</p>
<div class="codewrapper sourceCode" id="cb36">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a>other_currency_len <span class="op">==</span> <span class="dv">3</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>0       &lt;NA&gt;
1       &lt;NA&gt;
2       &lt;NA&gt;
3       &lt;NA&gt;
4       &lt;NA&gt;
        ...
8229    &lt;NA&gt;
8230    &lt;NA&gt;
8231    &lt;NA&gt;
8232    &lt;NA&gt;
8233    &lt;NA&gt;
Name: Currency - other, Length: 8149, dtype: boolean</code></pre>
</div>
<div id="challenge3" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Use boolean masking to find the values for <code>Currency</code>
corresponding to answers to <code>Currency - other</code> that are
exactly 3 characters long.</p>
<p>As a simple but incomplete sanity check, we know they should all be
“Other”!</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" aria-labelledby="headingSolution3" data-bs-parent="#accordionSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb38">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a>survey_data.loc[other_currency_len <span class="op">==</span> <span class="dv">3</span>, <span class="st">"Currency"</span>]</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>545     Other
690     Other
1210    Other
2369    Other
2513    Other
3704    Other
3975    Other
4701    Other
5377    Other
5414    Other
5643    Other
5902    Other
5905    Other
5918    Other
5979    Other
6009    Other
6083    Other
6253    Other
6320    Other
6348    Other
6431    Other
7117    Other
7155    Other
7168    Other
7198    Other
7289    Other
7366    Other
7689    Other
7805    Other
7965    Other
8001    Other
8080    Other
8186    Other
Name: Currency, dtype: string</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge4" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<em> (continued)</em>
</h3>
<div class="callout-content">
<p>Can you figure out, or guess, how to make those elements all upper
case?</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" aria-labelledby="headingSolution4" data-bs-parent="#accordionSolution4">
<div class="accordion-body">
<p>Use the function <code>str.upper()</code>:</p>
<div class="codewrapper sourceCode" id="cb40">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a>survey_data.loc[other_currency_len <span class="op">==</span> <span class="dv">3</span>, <span class="st">"Currency - other"</span>].<span class="bu">str</span>.upper()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>545     TTD
690     INR
1210    NOK
2369    MXN
2513    SEK
3704    SEK
3975    NOK
4701    NZD
5377    BRL
5414    NZD
5643    SGD
5902    DKK
5905    SEK
5918    NOK
5979    CZK
6009    HUF
6083    SFR
6253    NOK
6320    PLN
6348    KES
6431    MXN
7117    MYR
7155    IDR
7168    SGD
7198    SGD
7289    SGD
7366    NOK
7689    SGD
7805    AED
7965    CZK
8001    SGD
8080    PLN
8186    AED
Name: Currency - other, dtype: string</code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="challenge5" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<em> (continued)</em>
</h3>
<div class="callout-content">
<p>Finally, use those values to replace the original values in the
<code>Currency</code> column.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" aria-labelledby="headingSolution5" data-bs-parent="#accordionSolution5">
<div class="accordion-body">
<p>We have to make sure that we add the modified values to the right
column:</p>
<div class="codewrapper sourceCode" id="cb42">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a>survey_data.loc[other_currency_len <span class="op">==</span> <span class="dv">3</span>, <span class="st">"Currency"</span>] <span class="op">=</span> survey_data.loc[other_currency_len <span class="op">==</span> <span class="dv">3</span>, <span class="st">"Currency - other"</span>].<span class="bu">str</span>.upper()</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>If we did those last few steps correctly, we should have far fewer
“Other” values:</p>
<div class="codewrapper sourceCode" id="cb43">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" tabindex="-1"></a>survey_data.loc[survey_data[<span class="st">"Currency"</span>] <span class="op">==</span> <span class="st">"Other"</span>, <span class="st">"Currency - other"</span>].value_counts()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Currency - other
DKK (danish crowns)    1
INR Indian Rupee       1
Rupees                 1
Name: count, dtype: Int64</code></pre>
</div>
<p>Good. The last few we’ll have to do manually. Let’s assume that
“Rupees” also refers to Indian rupees (and not Mauritius, Nepal,
Pakistan, Sri Lanka, or any of the other countries with a currency
called Rupees).</p>
<div id="challenge6" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Can you use what you’ve learned so far to fix the remaining values in
the <code>Currency</code> column, based on the answers in the
<code>Currency - other</code> column?</p>
</div>
</div>
</div>
<div id="accordionHint1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint1" aria-expanded="false" aria-controls="collapseHint1">
  <h4 class="accordion-header" id="headingHint1"> Give me a hint </h4>
</button>
<div id="collapseHint1" class="accordion-collapse collapse" aria-labelledby="headingHint1" data-bs-parent="#accordionHint1">
<div class="accordion-body">
<p>You need to locate a single value, and set it to the desired value.
First think about how to find the row you’re interested in. Then which
column you want. Then pass both into <code>loc[]</code></p>
</div>
</div>
</div>
</div>
<div id="accordionSolution6" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution6" aria-expanded="false" aria-controls="collapseSolution6">
  <h4 class="accordion-header" id="headingSolution6"> Show me the solution </h4>
</button>
<div id="collapseSolution6" class="accordion-collapse collapse" aria-labelledby="headingSolution6" data-bs-parent="#accordionSolution6">
<div class="accordion-body">
<p>Here’s the first one:</p>
<div class="codewrapper sourceCode" id="cb45">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a>survey_data.loc[survey_data[<span class="st">"Currency - other"</span>] <span class="op">==</span> <span class="st">"DKK (danish crowns)"</span>, <span class="st">"Currency"</span>] <span class="op">=</span> <span class="st">"DKK"</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div id="accordionSolution7" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution7" aria-expanded="false" aria-controls="collapseSolution7">
  <h4 class="accordion-header" id="headingSolution7"> Show me the solution </h4>
</button>
<div id="collapseSolution7" class="accordion-collapse collapse" aria-labelledby="headingSolution7" data-bs-parent="#accordionSolution7">
<div class="accordion-body">
<p>Here are the other two:</p>
<div class="codewrapper sourceCode" id="cb46">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a>survey_data.loc[survey_data[<span class="st">"Currency - other"</span>] <span class="op">==</span> <span class="st">"INR Indian Rupee"</span>, <span class="st">"Currency"</span>] <span class="op">=</span> <span class="st">"INR"</span></span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a>survey_data.loc[survey_data[<span class="st">"Currency - other"</span>] <span class="op">==</span> <span class="st">"Rupees"</span>, <span class="st">"Currency"</span>] <span class="op">=</span> <span class="st">"INR"</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>OK, time to do the conversions. The U.K. government publishes average
annual GBP exchange rates on its website. You can find the data from
March 2025 in the file <code>data/average_csv_2025-3.csv</code>.</p>
<div class="codewrapper sourceCode" id="cb47">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" tabindex="-1"></a><span class="co"># Read the FX-rate file (average 2025 exchange rates)</span></span>
<span id="cb47-2"><a href="#cb47-2" tabindex="-1"></a>gbp_conversions <span class="op">=</span> pd.read_csv(<span class="st">"data/average_csv_2025-3.csv"</span>, index_col<span class="op">=</span><span class="st">"Country"</span>)</span>
<span id="cb47-3"><a href="#cb47-3" tabindex="-1"></a>gbp_conversions.head()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>             Unit Of Currency  ... Currency Units per £1
Country                        ...
Abu Dhabi              Dirham  ...                4.6865
Albania                   Lek  ...              118.5071
Algeria                 Dinar  ...              171.2515
Angola           Readj Kwanza  ...             1142.7772
Antigua    E Caribbean Dollar  ...                3.4492

[5 rows x 4 columns]</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb49">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a>gbp_conversions.columns</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Index(['Unit Of Currency', 'Currency Code',
       'Sterling value of Currency Unit £', 'Currency Units per £1'],
      dtype='object')</code></pre>
</div>
<p>Let’s get this ready to map values from any currency into GBP: -
we’re only interested in two columns: <code>Currency Code</code> and
<code>Sterling value of Currency Unit £</code> - we can give these
shorter names to save ourselves some typing - we want to look up values
using the currency code, so we should set that as the index, and then
it’s only one column that we’re interested in</p>
<div class="codewrapper sourceCode" id="cb51">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" tabindex="-1"></a>gbp_map <span class="op">=</span> gbp_conversions.loc[:, [<span class="st">"Currency Code"</span>, <span class="st">"Sterling value of Currency Unit £"</span>]]</span>
<span id="cb51-2"><a href="#cb51-2" tabindex="-1"></a>gbp_map <span class="op">=</span> gbp_map.rename(columns<span class="op">=</span>{<span class="st">"Currency Code"</span>: <span class="st">"Currency"</span>, <span class="st">"Sterling value of Currency Unit £"</span>: <span class="st">"Exchange rate"</span>})</span>
<span id="cb51-3"><a href="#cb51-3" tabindex="-1"></a>gbp_map <span class="op">=</span> gbp_map.set_index(<span class="st">"Currency"</span>)[<span class="st">"Exchange rate"</span>]</span>
<span id="cb51-4"><a href="#cb51-4" tabindex="-1"></a>gbp_map</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Currency
AED    0.2134
ALL    0.0084
DZD    0.0058
AOA    0.0009
XCD    0.2899
        ...
VND    0.0000
XPF    0.0071
WST    0.2834
YER    0.0031
ZMW    0.0295
Name: Exchange rate, Length: 162, dtype: float64</code></pre>
</div>
</section><section><h2 class="section-heading" id="check-which-values-occur-in-a-series-with-isin">Check which values occur in a Series with <code>isin()</code>
<a class="anchor" aria-label="anchor" href="#check-which-values-occur-in-a-series-with-isin"></a></h2>
<hr class="half-width"><p>Let’s check that all our currency codes appear in the exchange rate
data.</p>
<div class="codewrapper sourceCode" id="cb53">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a>survey_data[<span class="st">"Currency"</span>].isin(gbp_map.index).mean()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fu">np.float64</span><span class="op">(</span><span class="fl">0.9456375015339306</span><span class="op">)</span></span></code></pre>
</div>
<p>Only 95%! Let’s find the ones that are missing. We’ll need to use a
logical operator for negation, <code>~</code>. This turns True to False
and False to True.</p>
<div class="codewrapper sourceCode" id="cb55">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a>survey_data.loc[<span class="op">~</span>survey_data[<span class="st">"Currency"</span>].isin(gbp_map.index), <span class="st">"Currency"</span>].value_counts()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Currency
GBP    442
SFR      1
Name: count, dtype: Int64</code></pre>
</div>
<p>That makes sense! The U.K. Government data doesn’t include a GBP-GBP
exchange rate (we can probably work that one out in our heads).</p>
<p>Let’s add it manually to make our calculations easier</p>
<div class="codewrapper sourceCode" id="cb57">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a>gbp_map.loc[<span class="st">"GBP"</span>] <span class="op">=</span> <span class="dv">1</span></span></code></pre>
</div>
<p>We can use these conversions to put every salary in GBP. We’ll also
need to add any additional compensation to get the total.</p>
</section><section><h2 class="section-heading" id="use-map-to-efficiently-apply-a-function-to-every-element">Use <code>map()</code> to efficiently apply a function to every
element<a class="anchor" aria-label="anchor" href="#use-map-to-efficiently-apply-a-function-to-every-element"></a></h2>
<hr class="half-width"><p>First let’s convert the salary and additional compensation columns.
We can try to use <code>gbp_map</code> to get the exchange rates based
on currency codes</p>
<div class="codewrapper sourceCode" id="cb58">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a>survey_data[<span class="st">"Currency"</span>].<span class="bu">map</span>(gbp_map)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>pandas.errors.InvalidIndexError: Reindexing only valid with uniquely valued Index objects</code></pre>
</div>
<p>Uh oh! There’s a problem. Can you guess what’s happened here? It’s
not obvious, but the error message gives a clue.</p>
<div id="accordionSpoiler1" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler1" aria-expanded="false" aria-controls="collapseSpoiler1">
  <h3 class="accordion-header" id="headingSpoiler1">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Show details </h3>
</button>
<div id="collapseSpoiler1" class="accordion-collapse collapse" aria-labelledby="headingSpoiler1" data-bs-parent="#accordionSpoiler1">
<div class="accordion-body">
<p>The exchange rates data contains some duplicate currencies, because
some countries use the same currency (e.g. Bhutan uses INR). That means
we have some duplciate values in the index, and Pandas doesn’t know
which one we want - it doesn’t matter to Pandas that they’re the
same!</p>
<p>You can check this with</p>
<div class="codewrapper sourceCode" id="cb60">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a>gbp_map.index.value_counts()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Currency
XOF    8
XCD    7
XAF    6
AED    3
XPF    3
      ..
VND    1
WST    1
YER    1
ZMW    1
GBP    1
Name: count, Length: 141, dtype: int64</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="remove-duplicate-values-with-drop_duplicates-or-duplicated">Remove duplicate values with <code>drop_duplicates()</code> or
<code>duplicated()</code>
<a class="anchor" aria-label="anchor" href="#remove-duplicate-values-with-drop_duplicates-or-duplicated"></a></h2>
<hr class="half-width"><p>As usual Pandas has a function that can help us here:
<code>drop_duplicates()</code>. We need to remove duplicates from the
<em>index</em>, not the values - otherwise we’d be removing currencies
with the same rate, not necessarily the same code.</p>
<p>We could use <code>drop_duplicates()</code> on the index, but we have
no good way to map that back to the values. We can also use the
<code>duplicated()</code> function on the index to find labels that are
duplicated, and then use that to filter the DataFrame.</p>
<div class="codewrapper sourceCode" id="cb62">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a>gbp_map <span class="op">=</span> gbp_map[<span class="op">~</span>gbp_map.index.duplicated(keep<span class="op">=</span><span class="st">'first'</span>)]</span></code></pre>
</div>
<p>There’s that negation operator again. We want to include labels that
aren’t duplicated, so we use <code>~</code> to negate the boolean mask
returned by <code>duplicated()</code>. We also told duplicated to ignore
the first occurrence of each label with <code>keep='first'</code>.</p>
<div class="codewrapper sourceCode" id="cb63">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a>gbp_map.index.value_counts()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Currency
AED    1
ALL    1
DZD    1
AOA    1
XCD    1
      ..
VND    1
WST    1
YER    1
ZMW    1
GBP    1
Name: count, Length: 141, dtype: int64</code></pre>
</div>
<p>That’s better!</p>
<p>Now we can use <code>map()</code> to convert the currency values to
GBP:</p>
<div class="codewrapper sourceCode" id="cb65">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a>survey_data[<span class="st">"Currency"</span>].<span class="bu">map</span>(gbp_map)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>0       0.7836
1       1.0000
2       0.7836
3       0.7836
4       0.5654
         ...
8229    1.0000
8230    0.7836
8231    0.7836
8232    0.7836
8233    1.0000
Name: Currency, Length: 8149, dtype: float64</code></pre>
</div>
<p>We can add new columns to our DataFrame containing the converted
amounts. When we’re adding columns we should use <code>loc[]</code>:</p>
<div class="codewrapper sourceCode" id="cb67">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a>survey_data.loc[:, <span class="st">"Annual salary GBP"</span>] <span class="op">=</span> survey_data[<span class="st">"Annual salary"</span>] <span class="op">*</span> survey_data[<span class="st">"Currency"</span>].<span class="bu">map</span>(gbp_map)</span>
<span id="cb67-2"><a href="#cb67-2" tabindex="-1"></a>survey_data.loc[:, <span class="st">"Additional monetary compensation GBP"</span>] <span class="op">=</span> survey_data[<span class="st">"Additional monetary compensation"</span>] <span class="op">*</span> survey_data.loc[:, <span class="st">"Currency"</span>].<span class="bu">map</span>(gbp_map)</span>
<span id="cb67-3"><a href="#cb67-3" tabindex="-1"></a>survey_data.loc[:, <span class="st">"Total GBP"</span>] <span class="op">=</span> survey_data[<span class="st">"Annual salary GBP"</span>] <span class="op">+</span> survey_data[<span class="st">"Additional monetary compensation GBP"</span>]</span></code></pre>
</div>
<p>Now we’re finally ready to plot the distribution we’re interested in:
a histogram of total compensation in GBP.</p>
<div class="codewrapper sourceCode" id="cb68">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb68-2"><a href="#cb68-2" tabindex="-1"></a></span>
<span id="cb68-3"><a href="#cb68-3" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">5</span>))</span>
<span id="cb68-4"><a href="#cb68-4" tabindex="-1"></a>plt.hist(survey_data[<span class="st">"Total GBP"</span>], bins<span class="op">=</span><span class="dv">50</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb68-5"><a href="#cb68-5" tabindex="-1"></a>plt.show()</span></code></pre>
</div>
<figure><img src="fig/02-data-exploration-and-preprocessing-rendered-unnamed-chunk-38-1.png" width="768" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Ah. Looks like almost all the values are condensed into a single
band, but the axis range is huge, because someone claims to earn around
£800 million.</p>
<p>Let’s have a quick look at the stats. Explore the values with
describe:</p>
<div class="codewrapper sourceCode" id="cb69">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a>survey_data[<span class="st">"Total GBP"</span>].describe()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>count    8.148000e+03
mean     1.992544e+05
std      9.427335e+06
min      0.000000e+00
25%      5.060330e+04
50%      7.002600e+04
75%      1.018680e+05
max      8.478568e+08
Name: Total GBP, dtype: float64</code></pre>
</div>
<div id="challenge7" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge</h3>
<div class="callout-content">
<p>Can you pull out the row containing the maximum value of
<code>Total GBP</code> and print it as a column?</p>
</div>
</div>
</div>
<div id="accordionHint2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint2" aria-expanded="false" aria-controls="collapseHint2">
  <h4 class="accordion-header" id="headingHint2"> Give me a hint </h4>
</button>
<div id="collapseHint2" class="accordion-collapse collapse" aria-labelledby="headingHint2" data-bs-parent="#accordionHint2">
<div class="accordion-body">
<p>You can use <code>survey_data["Total GBP"].max()</code> to find the
maximum value, and then use <code>loc[]</code> to select the row with
that value.</p>
</div>
</div>
</div>
</div>
<div id="accordionHint3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button hint-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseHint3" aria-expanded="false" aria-controls="collapseHint3">
  <h4 class="accordion-header" id="headingHint3"> Give me a hint </h4>
</button>
<div id="collapseHint3" class="accordion-collapse collapse" aria-labelledby="headingHint3" data-bs-parent="#accordionHint3">
<div class="accordion-body">
<p>Use <code>T</code> to flip the orientation from a row to a column</p>
</div>
</div>
</div>
</div>
<div id="accordionSolution8" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution8" aria-expanded="false" aria-controls="collapseSolution8">
  <h4 class="accordion-header" id="headingSolution8"> Show me the solution </h4>
</button>
<div id="collapseSolution8" class="accordion-collapse collapse" aria-labelledby="headingSolution8" data-bs-parent="#accordionSolution8">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb71">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" tabindex="-1"></a>survey_data.loc[survey_data[<span class="st">"Total GBP"</span>] <span class="op">==</span> survey_data[<span class="st">"Total GBP"</span>].<span class="bu">max</span>()].T</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                                                          7708
Timestamp                                   4/12/2025 12:37:12
Age                                                      55-64
Industry                                  Hospitality &amp; Events
Functional area of job                Property or Construction
Job title                                      Program Manager
Additional context                                        &lt;NA&gt;
Annual salary                                       1082000000
Additional monetary compensation                          2000
Currency                                                   USD
Currency - other                                          &lt;NA&gt;
Income - additional context                               &lt;NA&gt;
Country                                          United States
State                                               Washington
City/region                                      Pierce County
Remote or on-site?                                     On-site
Unionized?                                                  No
Years of experience                                31-40 years
Years in field                                     11-20 years
Highest level of education                        Some college
Gender                                                     Man
Race                                                     White
Disabled?                                                   No
Annual salary GBP                                  847855200.0
Additional monetary compensation GBP                    1567.2
Total GBP                                          847856767.2</code></pre>
</div>
</div>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="remove-outliers">Remove outliers<a class="anchor" aria-label="anchor" href="#remove-outliers"></a></h2>
<hr class="half-width"><p>A property and construction program manager for a hospitality and
events company on a salary of $1 billion seems unlikely to me. How does
it compare to the next few largest values?</p>
<div class="codewrapper sourceCode" id="cb73">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" tabindex="-1"></a><span class="co"># get the highest five values in Total GBP</span></span>
<span id="cb73-2"><a href="#cb73-2" tabindex="-1"></a>survey_data.sort_values(<span class="st">"Total GBP"</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">15</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>               Timestamp  ...     Total GBP
7708  4/12/2025 12:37:12  ...  8.478568e+08
6888   4/9/2025 16:04:03  ...  7.262507e+07
4109   4/8/2025 15:26:31  ...  1.222416e+07
2715   4/8/2025 13:05:27  ...  3.844906e+06
5739   4/8/2025 23:47:05  ...  1.030434e+06
1209   4/8/2025 11:45:22  ...  9.951720e+05
1161   4/8/2025 11:43:16  ...  8.462880e+05
3845   4/8/2025 14:47:32  ...  8.227800e+05
4884   4/8/2025 18:14:58  ...  7.840717e+05
2113   4/8/2025 12:24:17  ...  7.052400e+05
2531   4/8/2025 12:52:21  ...  7.000000e+05
3498   4/8/2025 14:05:22  ...  6.268800e+05
5353   4/8/2025 20:46:59  ...  5.892672e+05
5848    4/9/2025 1:31:47  ...  5.798640e+05
1570   4/8/2025 11:59:31  ...  5.649756e+05

[15 rows x 25 columns]</code></pre>
</div>
<p>The max is more than 10 times the next largest value. I think we can
safely delete at least the largest row, and maybe anything else over,
say, £1 million.</p>
<div class="codewrapper sourceCode" id="cb75">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" tabindex="-1"></a>survey_data <span class="op">=</span> survey_data[survey_data[<span class="st">"Total GBP"</span>] <span class="op">&lt;</span> <span class="fl">1e6</span>]</span></code></pre>
</div>
<div id="callout5" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Survey data, particularly when collected online, is notoriously
noisy. Some people are stupid, some peopel make mistakes, and some just
like to mess with surveys. As a results, there is usually a reasonable
percentage of responses that can’t be trusted. If you’re lucky, these
are obvious.</p>
<p>This is sometimes know as the “Lizardman Factor” or “Lizardman’s
constant”, named after a 2012 survey that found that 4% of people
believed that shape-shifting reptilian people have taken on human form
and now control our world.</p>
</div>
</div>
</div>
<p>Let’s check the distribution again, now that we’ve removed the
outliers:</p>
<div class="codewrapper sourceCode" id="cb76">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">5</span>))</span>
<span id="cb76-2"><a href="#cb76-2" tabindex="-1"></a>plt.hist(survey_data[<span class="st">"Total GBP"</span>], bins<span class="op">=</span><span class="dv">50</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb76-3"><a href="#cb76-3" tabindex="-1"></a>plt.show()</span></code></pre>
</div>
<figure><img src="fig/02-data-exploration-and-preprocessing-rendered-unnamed-chunk-43-3.png" width="768" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>That’s better! We can see a more reasonable distribution of salaries,
with a long thiin tail towards the top end.</p>
</section><section><h2 class="section-heading" id="compare-salaries-by-country-using-groupby">Compare salaries by country using <code>groupby()</code>
<a class="anchor" aria-label="anchor" href="#compare-salaries-by-country-using-groupby"></a></h2>
<hr class="half-width"><p>Let’s look at the average salary by country. We’ll use
<code>groupby()</code> to group the data by country, and then calculate
the mean of the total compensation for each group.</p>
<div class="codewrapper sourceCode" id="cb77">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" tabindex="-1"></a>country_salary <span class="op">=</span> survey_data.groupby(<span class="st">"Country"</span>)[<span class="st">"Total GBP"</span>].mean().sort_values(ascending<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb77-2"><a href="#cb77-2" tabindex="-1"></a>country_salary</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Country
Hong Kong                 270342.0000
Caribbean                 239487.7500
UAE                       220228.8000
Europe for US company     215490.0000
Finlanf                   193614.0000
                             ...
Vietnam                     9707.2368
India                       7723.6500
The country of Europe       1352.5920
Trinidad and Tobago          623.7000
Indonesia                      0.0000
Name: Total GBP, Length: 78, dtype: float64</code></pre>
</div>
<p>We can plot this as a bar chart to make it easier to see the
differences:</p>
<div class="codewrapper sourceCode" id="cb79">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">10</span>), layout<span class="op">=</span><span class="st">"constrained"</span>)</span>
<span id="cb79-2"><a href="#cb79-2" tabindex="-1"></a>country_salary.plot(kind<span class="op">=</span><span class="st">'barh'</span>)</span>
<span id="cb79-3"><a href="#cb79-3" tabindex="-1"></a>plt.yticks(fontsize<span class="op">=</span><span class="dv">4</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>(array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14, 15, 16,
       17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33,
       34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50,
       51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67,
       68, 69, 70, 71, 72, 73, 74, 75, 76, 77]), [Text(0, 0, 'Hong Kong'), Text(0, 1, 'Caribbean'), Text(0, 2, 'UAE'), Text(0, 3, 'Europe for US company '), Text(0, 4, 'Finlanf'), Text(0, 5, 'México '), Text(0, 6, 'Nigeria'), Text(0, 7, 'Israel'), Text(0, 8, 'Switzerland'), Text(0, 9, 'Mongolia'), Text(0, 10, 'Saudi Arabia'), Text(0, 11, 'Aotearoa New Zealand '), Text(0, 12, 'Ghana'), Text(0, 13, 'Switzerland '), Text(0, 14, 'Jamaica'), Text(0, 15, 'United States'), Text(0, 16, 'switzerland'), Text(0, 17, 'Luxembourg '), Text(0, 18, 'Czech Republic'), Text(0, 19, 'United Arab Emirates'), Text(0, 20, 'Denmark'), Text(0, 21, 'Ireland'), Text(0, 22, 'new zealand'), Text(0, 23, 'Singapore'), Text(0, 24, 'New Zealand '), Text(0, 25, 'france'), Text(0, 26, 'Luxembourg'), Text(0, 27, 'Australia'), Text(0, 28, 'China'), Text(0, 29, 'the Netherlands'), Text(0, 30, 'Norway'), Text(0, 31, 'Austria '), Text(0, 32, 'Canada'), Text(0, 33, 'Netherlands '), Text(0, 34, 'Italy'), Text(0, 35, 'Netherlands'), Text(0, 36, 'Southeast Asia'), Text(0, 37, 'United Kingdom'), Text(0, 38, 'NZ'), Text(0, 39, 'Austria'), Text(0, 40, 'New Zealand'), Text(0, 41, 'Kenya'), Text(0, 42, 'Finland'), Text(0, 43, 'South Africa'), Text(0, 44, 'Germany'), Text(0, 45, 'Belgium'), Text(0, 46, 'The Netherlands '), Text(0, 47, 'Portugal'), Text(0, 48, 'France'), Text(0, 49, 'Hungary'), Text(0, 50, 'North Macedonia'), Text(0, 51, 'Greece '), Text(0, 52, 'South Korea'), Text(0, 53, 'I live in Canada, but my employer is in the USA'), Text(0, 54, 'Sweden'), Text(0, 55, 'Sweden '), Text(0, 56, 'Spain'), Text(0, 57, 'Finland '), Text(0, 58, 'The Netherlands'), Text(0, 59, 'Remotely moving in Southeast Asia'), Text(0, 60, 'Aotearoa New Zealand'), Text(0, 61, 'il'), Text(0, 62, 'argentina '), Text(0, 63, 'Mexico'), Text(0, 64, 'Brazil'), Text(0, 65, 'Poland'), Text(0, 66, 'Internationally - multiple countries as needed '), Text(0, 67, 'Japan'), Text(0, 68, 'Belgium '), Text(0, 69, 'Japan '), Text(0, 70, 'Latvia'), Text(0, 71, 'Malaysia'), Text(0, 72, 'Czechia'), Text(0, 73, 'Vietnam'), Text(0, 74, 'India'), Text(0, 75, 'The country of Europe'), Text(0, 76, 'Trinidad and Tobago'), Text(0, 77, 'Indonesia')])</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb81">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" tabindex="-1"></a>plt.layout()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>AttributeError: module 'matplotlib.pyplot' has no attribute 'layout'</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb83">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" tabindex="-1"></a>plt.show()</span></code></pre>
</div>
<figure><img src="fig/02-data-exploration-and-preprocessing-rendered-unnamed-chunk-45-5.png" width="960" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>We can see that a lot of the countries have been entered manually, so
the data is messy. We won’t clean these up now. Note that in a rigorous
analysis you would want to normalise for cost of living,
purchasing-power parity (PPP), and so on.</p>
</section><section><h2 class="section-heading" id="use-groupby-to-perform-calculations-on-groups-of-data">Use <code>groupby()</code> to perform calculations on groups of
data<a class="anchor" aria-label="anchor" href="#use-groupby-to-perform-calculations-on-groups-of-data"></a></h2>
<hr class="half-width"><p>Let’s move onto our next question: - Do unionised jobs earn more or
less than non-unionised?</p>
<div class="codewrapper sourceCode" id="cb84">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" tabindex="-1"></a>union_salary <span class="op">=</span> survey_data.groupby(<span class="st">"Unionized?"</span>)[<span class="st">"Total GBP"</span>].mean()</span>
<span id="cb84-2"><a href="#cb84-2" tabindex="-1"></a>union_salary</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Unionized?
No     87951.627244
Yes    64302.693696
Name: Total GBP, dtype: float64</code></pre>
</div>
<p>At first glance, the unionised jobs earn less Let’s look in more
detail with a box plot.</p>
<div class="codewrapper sourceCode" id="cb86">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" tabindex="-1"></a><span class="co"># plot a box-and-whisker diagram of the total compensation by union status</span></span>
<span id="cb86-2"><a href="#cb86-2" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">4</span>))</span>
<span id="cb86-3"><a href="#cb86-3" tabindex="-1"></a></span>
<span id="cb86-4"><a href="#cb86-4" tabindex="-1"></a>survey_data.boxplot(</span>
<span id="cb86-5"><a href="#cb86-5" tabindex="-1"></a>  by<span class="op">=</span><span class="st">"Unionized?"</span>,</span>
<span id="cb86-6"><a href="#cb86-6" tabindex="-1"></a>  column<span class="op">=</span><span class="st">"Total GBP"</span>,</span>
<span id="cb86-7"><a href="#cb86-7" tabindex="-1"></a>)</span>
<span id="cb86-8"><a href="#cb86-8" tabindex="-1"></a>plt.show()</span></code></pre>
</div>
<p><img src="fig/02-data-exploration-and-preprocessing-rendered-unnamed-chunk-47-7.png" width="672" style="display: block; margin: auto;" class="figure"><img src="fig/02-data-exploration-and-preprocessing-rendered-unnamed-chunk-47-8.png" width="576" style="display: block; margin: auto;" class="figure">
That seems to hold up. We could run some statistical tests to figure out
for sure, but let’s move on.</p>
</section><section><h2 class="section-heading" id="use-ordinalencoder-for-features-that-have-an-implicit-order">Use <code>OrdinalEncoder()</code> for features that have an implicit
order<a class="anchor" aria-label="anchor" href="#use-ordinalencoder-for-features-that-have-an-implicit-order"></a></h2>
<hr class="half-width"><p>Our next question was: - Does salary go up with age, years of
experience, and education level?</p>
<p>Salary is a numeric variable, but age, years of experience, and
education level are all categorical variables with an implicit order. We
can use the <code>OrdinalEncoder</code> from scikit-learn to convert
these into numeric values that we can use in our analysis.</p>
<p>OrdinalEncoder is slightly more complicated than the LabelEncoder we
saw on Day 1. We want to specify the order of our categories to respect
the underlying order, so we have to manually define the categories based
on what we know about the data:</p>
<div class="codewrapper sourceCode" id="cb87">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" tabindex="-1"></a>ordinal_cols <span class="op">=</span> [<span class="st">"Age"</span>, <span class="st">"Years of experience"</span>, <span class="st">"Years in field"</span>, <span class="st">"Highest level of education"</span>]</span>
<span id="cb87-2"><a href="#cb87-2" tabindex="-1"></a><span class="cf">for</span> col <span class="kw">in</span> ordinal_cols:</span>
<span id="cb87-3"><a href="#cb87-3" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>col<span class="sc">}</span><span class="ss">:</span><span class="ch">\n</span><span class="sc">{</span>survey_data[col]<span class="sc">.</span>value_counts()<span class="sc">}</span><span class="ch">\n</span><span class="ss">"</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Age:
Age
35-44         3400
25-34         2258
45-54         1596
55-64          709
18-24           88
65 or over      88
under 18         4
Name: count, dtype: Int64

Years of experience:
Years of experience
11-20 years         3311
21-30 years         1747
8-10 years          1222
5-7 years            761
31-40 years          593
2-4 years            334
41 years or more     119
1 year or less        56
Name: count, dtype: Int64

Years in field:
Years in field
11-20 years         2547
8-10 years          1561
5-7 years           1355
2-4 years           1130
21-30 years         1005
31-40 years          272
1 year or less       239
41 years or more      34
Name: count, dtype: Int64

Highest level of education:
Highest level of education
Bachelor's degree                     3387
Master's degree                       2912
Doctorate                              570
Professional degree (MD, JD, etc.)     447
Some college                           435
                                      ...
Did not graduate high school             1
High school dropout                      1
Canadian College Diploma                 1
CPA designation w/Bachelor Degree        1
Master's +                               1
Name: count, Length: 90, dtype: Int64</code></pre>
</div>
<ul><li>The categories for the two “Years…” columns are the same.</li>
<li>The Education columns accepts free text, so it has lots of rare
answers as well as the 7 default options. Let’s ignore all but the top
7</li>
</ul><div class="codewrapper sourceCode" id="cb89">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" tabindex="-1"></a>age_category <span class="op">=</span> [<span class="st">"under 18"</span>, <span class="st">"18-24"</span>, <span class="st">"25-34"</span>, <span class="st">"35-44"</span>, <span class="st">"45-54"</span>, <span class="st">"55-64"</span>, <span class="st">"65 or over"</span>]</span>
<span id="cb89-2"><a href="#cb89-2" tabindex="-1"></a></span>
<span id="cb89-3"><a href="#cb89-3" tabindex="-1"></a>experience_category <span class="op">=</span> [</span>
<span id="cb89-4"><a href="#cb89-4" tabindex="-1"></a>    <span class="st">"1 year or less"</span>, </span>
<span id="cb89-5"><a href="#cb89-5" tabindex="-1"></a>    <span class="st">"2-4 years"</span>, </span>
<span id="cb89-6"><a href="#cb89-6" tabindex="-1"></a>    <span class="st">"5-7 years"</span>, </span>
<span id="cb89-7"><a href="#cb89-7" tabindex="-1"></a>    <span class="st">"8-10 years"</span>, </span>
<span id="cb89-8"><a href="#cb89-8" tabindex="-1"></a>    <span class="st">"11-20 years"</span>, </span>
<span id="cb89-9"><a href="#cb89-9" tabindex="-1"></a>    <span class="st">"21-30 years"</span>, </span>
<span id="cb89-10"><a href="#cb89-10" tabindex="-1"></a>    <span class="st">"31-40 years"</span>, </span>
<span id="cb89-11"><a href="#cb89-11" tabindex="-1"></a>    <span class="st">"41 years or more"</span>,</span>
<span id="cb89-12"><a href="#cb89-12" tabindex="-1"></a>]</span>
<span id="cb89-13"><a href="#cb89-13" tabindex="-1"></a></span>
<span id="cb89-14"><a href="#cb89-14" tabindex="-1"></a>education_category <span class="op">=</span> [</span>
<span id="cb89-15"><a href="#cb89-15" tabindex="-1"></a>    <span class="st">"Less than secondary"</span>,</span>
<span id="cb89-16"><a href="#cb89-16" tabindex="-1"></a>    <span class="st">"High school / secondary"</span>,</span>
<span id="cb89-17"><a href="#cb89-17" tabindex="-1"></a>    <span class="st">"Some college"</span>,</span>
<span id="cb89-18"><a href="#cb89-18" tabindex="-1"></a>    <span class="st">"Bachelor's degree"</span>,</span>
<span id="cb89-19"><a href="#cb89-19" tabindex="-1"></a>    <span class="st">"Master's degree"</span>,</span>
<span id="cb89-20"><a href="#cb89-20" tabindex="-1"></a>    <span class="st">"Professional degree (JD, MD, etc.)"</span>,</span>
<span id="cb89-21"><a href="#cb89-21" tabindex="-1"></a>    <span class="st">"Doctorate"</span>,</span>
<span id="cb89-22"><a href="#cb89-22" tabindex="-1"></a>]</span></code></pre>
</div>
<p>We can then create an OrdinalEncoder with these categories:</p>
<div class="codewrapper sourceCode" id="cb90">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> OrdinalEncoder</span>
<span id="cb90-2"><a href="#cb90-2" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" tabindex="-1"></a>ordinal_encoder <span class="op">=</span> OrdinalEncoder(categories<span class="op">=</span>[age_category, experience_category, experience_category, education_category])</span></code></pre>
</div>
<p>Now we can use this encoder to transform the ordinal columns in our
DataFrame. We’ll apply it to the columns <code>age</code>,
<code>years_experience</code>, and
<code>highest_level_of_education</code>, and save this data in a new
dataframe. We’ll also add the numeric data columns. And let’s not forget
to ignore the rows that contain the less common education answers!</p>
<div class="codewrapper sourceCode" id="cb91">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" tabindex="-1"></a>ordinal_cols <span class="op">=</span> [<span class="st">"Age"</span>, <span class="st">"Years of experience"</span>, <span class="st">"Years in field"</span>, <span class="st">"Highest level of education"</span>]</span>
<span id="cb91-2"><a href="#cb91-2" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" tabindex="-1"></a>survey_data_standard_education <span class="op">=</span> survey_data[survey_data[<span class="st">"Highest level of education"</span>].isin(education_category)]</span>
<span id="cb91-4"><a href="#cb91-4" tabindex="-1"></a></span>
<span id="cb91-5"><a href="#cb91-5" tabindex="-1"></a>survey_data_encoded <span class="op">=</span> survey_data_standard_education[[<span class="st">"Annual salary GBP"</span>, <span class="st">"Additional monetary compensation GBP"</span>, <span class="st">"Total GBP"</span>]].copy()</span>
<span id="cb91-6"><a href="#cb91-6" tabindex="-1"></a>survey_data_encoded[ordinal_cols] <span class="op">=</span> ordinal_encoder.fit_transform(survey_data_standard_education[ordinal_cols])</span></code></pre>
</div>
</section><section><h2 class="section-heading" id="calculate-correlations-with-dataframe-corr">Calculate correlations with <code>DataFrame.corr()</code>
<a class="anchor" aria-label="anchor" href="#calculate-correlations-with-dataframe-corr"></a></h2>
<hr class="half-width"><p>Let’s calculate the correlations and see the relationships between
these variables. We can calculate the correlation matrix with
<code>corr()</code>, and visualise the results in a heatmap with
<code>imshow()</code>:</p>
<div class="codewrapper sourceCode" id="cb92">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" tabindex="-1"></a><span class="co"># Calculate the correlation matrix</span></span>
<span id="cb92-2"><a href="#cb92-2" tabindex="-1"></a>correlation_matrix <span class="op">=</span> survey_data_encoded.corr()</span>
<span id="cb92-3"><a href="#cb92-3" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>), layout<span class="op">=</span><span class="st">"constrained"</span>)</span>
<span id="cb92-5"><a href="#cb92-5" tabindex="-1"></a>heatmap <span class="op">=</span> ax.imshow(correlation_matrix, cmap<span class="op">=</span><span class="st">'coolwarm'</span>)</span>
<span id="cb92-6"><a href="#cb92-6" tabindex="-1"></a></span>
<span id="cb92-7"><a href="#cb92-7" tabindex="-1"></a>ax.set_xticks(<span class="bu">range</span>(<span class="bu">len</span>(correlation_matrix.columns)))</span>
<span id="cb92-8"><a href="#cb92-8" tabindex="-1"></a>ax.set_yticks(<span class="bu">range</span>(<span class="bu">len</span>(correlation_matrix.columns)))</span>
<span id="cb92-9"><a href="#cb92-9" tabindex="-1"></a></span>
<span id="cb92-10"><a href="#cb92-10" tabindex="-1"></a>ax.set_xticklabels(correlation_matrix.columns, rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb92-11"><a href="#cb92-11" tabindex="-1"></a>ax.set_yticklabels(correlation_matrix.columns)</span>
<span id="cb92-12"><a href="#cb92-12" tabindex="-1"></a></span>
<span id="cb92-13"><a href="#cb92-13" tabindex="-1"></a>fig.colorbar(heatmap, ax<span class="op">=</span>ax, orientation<span class="op">=</span><span class="st">'vertical'</span>, label<span class="op">=</span><span class="st">'Correlation Coefficient'</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;matplotlib.colorbar.Colorbar object at 0x000001D6E5859010&gt;</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb94">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" tabindex="-1"></a>plt.show()</span></code></pre>
</div>
<figure><img src="fig/02-data-exploration-and-preprocessing-rendered-unnamed-chunk-52-11.png" width="960" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>This shows some interesting patterns. What do you notice?</p>
<div id="accordionSpoiler2" class="accordion spoiler-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button spoiler-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSpoiler2" aria-expanded="false" aria-controls="collapseSpoiler2">
  <h3 class="accordion-header" id="headingSpoiler2">  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="eye"></i></div> Show details </h3>
</button>
<div id="collapseSpoiler2" class="accordion-collapse collapse" aria-labelledby="headingSpoiler2" data-bs-parent="#accordionSpoiler2">
<div class="accordion-body">
<ul><li>The strongest correlation is between <code>Annual salary GBP</code>
and <code>Total GBP</code>
</li>
<li>
<code>Additional monetary compensation GBP</code> is correlated with
<code>Total GBP</code>, but its contribution is weaker than the
salary</li>
<li>
<code>Annual salary</code> and
<code>Additional monetary compensation GBP</code> are at best weakly
correlated with each other</li>
<li>The time fields, Age, Years of experience, and Years in field, form
a cluster</li>
<li>There appears to be no relationship between any of the time factors
and the compensation factors</li>
<li>Education level is not correlated with anything</li>
</ul></div>
</div>
</div>
</div>
<p>Now let’s plot the relationships between these variables.</p>
<div class="codewrapper sourceCode" id="cb95">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" tabindex="-1"></a><span class="co"># Use matplotlib to plot Total compensation GBP against the other columns in survey_data_encoded</span></span>
<span id="cb95-2"><a href="#cb95-2" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb95-3"><a href="#cb95-3" tabindex="-1"></a></span>
<span id="cb95-4"><a href="#cb95-4" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">3</span>, figsize<span class="op">=</span>(<span class="dv">20</span>, <span class="dv">10</span>), layout<span class="op">=</span><span class="st">"constrained"</span>)</span>
<span id="cb95-5"><a href="#cb95-5" tabindex="-1"></a></span>
<span id="cb95-6"><a href="#cb95-6" tabindex="-1"></a></span>
<span id="cb95-7"><a href="#cb95-7" tabindex="-1"></a><span class="kw">def</span> scatter_plot(ax, x_col, y_col, title):</span>
<span id="cb95-8"><a href="#cb95-8" tabindex="-1"></a>    ax.scatter(survey_data_encoded[x_col], survey_data_encoded[y_col], alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb95-9"><a href="#cb95-9" tabindex="-1"></a>    ax.set_xlabel(x_col.replace(<span class="st">"_"</span>, <span class="st">" "</span>).title())</span>
<span id="cb95-10"><a href="#cb95-10" tabindex="-1"></a>    ax.set_ylabel(y_col.replace(<span class="st">"_"</span>, <span class="st">" "</span>).title())</span>
<span id="cb95-11"><a href="#cb95-11" tabindex="-1"></a>    ax.set_title(title)</span>
<span id="cb95-12"><a href="#cb95-12" tabindex="-1"></a>    </span>
<span id="cb95-13"><a href="#cb95-13" tabindex="-1"></a>scatter_plot(axs[<span class="dv">0</span>, <span class="dv">0</span>], <span class="st">"Age"</span>, <span class="st">"Total GBP"</span>, <span class="st">"Total compensation vs. Age"</span>)</span>
<span id="cb95-14"><a href="#cb95-14" tabindex="-1"></a>scatter_plot(axs[<span class="dv">0</span>, <span class="dv">1</span>], <span class="st">"Years of experience"</span>, <span class="st">"Total GBP"</span>, <span class="st">"Total compensation vs. Years of experience"</span>)</span>
<span id="cb95-15"><a href="#cb95-15" tabindex="-1"></a>scatter_plot(axs[<span class="dv">0</span>, <span class="dv">2</span>], <span class="st">"Years in field"</span>, <span class="st">"Total GBP"</span>, <span class="st">"Total compensation vs. Years in field"</span>)</span>
<span id="cb95-16"><a href="#cb95-16" tabindex="-1"></a>scatter_plot(axs[<span class="dv">1</span>, <span class="dv">0</span>], <span class="st">"Highest level of education"</span>, <span class="st">"Total GBP"</span>, <span class="st">"Total compensation vs. Education level"</span>)</span>
<span id="cb95-17"><a href="#cb95-17" tabindex="-1"></a>scatter_plot(axs[<span class="dv">1</span>, <span class="dv">1</span>], <span class="st">"Additional monetary compensation GBP"</span>, <span class="st">"Annual salary GBP"</span>, <span class="st">"Additional compensation vs. Annual salary"</span>)</span>
<span id="cb95-18"><a href="#cb95-18" tabindex="-1"></a>scatter_plot(axs[<span class="dv">1</span>, <span class="dv">2</span>], <span class="st">"Additional monetary compensation GBP"</span>, <span class="st">"Total GBP"</span>, <span class="st">"Total compensation vs. Annual salary"</span>)</span>
<span id="cb95-19"><a href="#cb95-19" tabindex="-1"></a></span>
<span id="cb95-20"><a href="#cb95-20" tabindex="-1"></a>plt.show()</span></code></pre>
</div>
<figure><img src="fig/02-data-exploration-and-preprocessing-rendered-unnamed-chunk-53-13.png" width="1920" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>Looking again at the relationship between salary and additional
income, we can see that there is more structure than we might have
thought at first. It looks like there are two trends: people with the
highest incomes are less likely to have additional income; and as
additional income goes up, salary increases slightly. We can’t tell any
of this from the correlation alone.</p>
<div id="callout6" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout</h3>
<div class="callout-content">
<p>Correlations and summary statistics are useful and powerful, but they
can be misleading.</p>
<p>This is Anscombe’s quartet, a set of four datasets that have
identical mean, variance, correlation and regression, but resoundingly
varied structure.</p>
<p><img src="fig/Anscombes_quartet_3.svg" alt="Correlation can be misleading" class="figure">{alt=‘Image of Anscombe’s quartet,
showing four datasets with the same correlation but very different
structures’} Attribution: Schutz(label using subscripts): Avenue -
Anscombe.svg, CC BY-SA 3.0, <a href="https://commons.wikimedia.org/w/index.php?curid=9838454" class="external-link uri">https://commons.wikimedia.org/w/index.php?curid=9838454</a></p>
<figure><img src="fig/datasaurus_dozen.png" alt="Image of the Datasaurus Dozen, a set of 12 datasets with the same summary statistics but very, very different structures!" class="figure mx-auto d-block"><div class="figcaption">And this is the Datasaurus Dozen!</div>
</figure></div>
</div>
</div>
</section><section><h2 class="section-heading" id="use-pca-to-visualise-more-complex-structures">Use PCA to visualise more complex structures<a class="anchor" aria-label="anchor" href="#use-pca-to-visualise-more-complex-structures"></a></h2>
<hr class="half-width"><p>Principal-components analysis (PCA) lets us project many variables
onto a 2-D plane while preserving as much variance as possible.</p>
<div class="codewrapper sourceCode" id="cb96">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" tabindex="-1"></a><span class="im">from</span> sklearn.preprocessing <span class="im">import</span> StandardScaler</span>
<span id="cb96-2"><a href="#cb96-2" tabindex="-1"></a><span class="im">from</span> sklearn.decomposition <span class="im">import</span> PCA</span>
<span id="cb96-3"><a href="#cb96-3" tabindex="-1"></a></span>
<span id="cb96-4"><a href="#cb96-4" tabindex="-1"></a>features <span class="op">=</span> [</span>
<span id="cb96-5"><a href="#cb96-5" tabindex="-1"></a>    <span class="st">"Age"</span>,</span>
<span id="cb96-6"><a href="#cb96-6" tabindex="-1"></a>    <span class="st">"Years of experience"</span>,</span>
<span id="cb96-7"><a href="#cb96-7" tabindex="-1"></a>    <span class="st">"Years in field"</span>,</span>
<span id="cb96-8"><a href="#cb96-8" tabindex="-1"></a>    <span class="st">"Highest level of education"</span>,</span>
<span id="cb96-9"><a href="#cb96-9" tabindex="-1"></a>    <span class="st">"Total GBP"</span>,</span>
<span id="cb96-10"><a href="#cb96-10" tabindex="-1"></a>]</span>
<span id="cb96-11"><a href="#cb96-11" tabindex="-1"></a></span>
<span id="cb96-12"><a href="#cb96-12" tabindex="-1"></a>X <span class="op">=</span> survey_data_encoded[features]</span>
<span id="cb96-13"><a href="#cb96-13" tabindex="-1"></a>X_scaled <span class="op">=</span> StandardScaler().fit_transform(X)</span>
<span id="cb96-14"><a href="#cb96-14" tabindex="-1"></a></span>
<span id="cb96-15"><a href="#cb96-15" tabindex="-1"></a><span class="co"># PCA</span></span>
<span id="cb96-16"><a href="#cb96-16" tabindex="-1"></a>pca <span class="op">=</span> PCA(n_components<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb96-17"><a href="#cb96-17" tabindex="-1"></a>components <span class="op">=</span> pca.fit_transform(X_scaled)</span>
<span id="cb96-18"><a href="#cb96-18" tabindex="-1"></a></span>
<span id="cb96-19"><a href="#cb96-19" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb96-20"><a href="#cb96-20" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">6</span>,<span class="dv">5</span>))</span>
<span id="cb96-21"><a href="#cb96-21" tabindex="-1"></a>scatter <span class="op">=</span> plt.scatter(</span>
<span id="cb96-22"><a href="#cb96-22" tabindex="-1"></a>    components[:,<span class="dv">0</span>], components[:,<span class="dv">1</span>],</span>
<span id="cb96-23"><a href="#cb96-23" tabindex="-1"></a>    c<span class="op">=</span>survey_data_encoded[<span class="st">"Total GBP"</span>], cmap<span class="op">=</span><span class="st">"viridis"</span>, alpha<span class="op">=</span><span class="fl">0.5</span></span>
<span id="cb96-24"><a href="#cb96-24" tabindex="-1"></a>)</span>
<span id="cb96-25"><a href="#cb96-25" tabindex="-1"></a>plt.colorbar(scatter, label<span class="op">=</span><span class="st">"Compensation (GBP)"</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>&lt;matplotlib.colorbar.Colorbar object at 0x000001D6FDFAE450&gt;</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb98">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" tabindex="-1"></a>plt.xlabel(<span class="st">"PC 1 ("</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">round</span>(pca.explained_variance_ratio_[<span class="dv">0</span>]<span class="op">*</span><span class="dv">100</span>,<span class="dv">1</span>)) <span class="op">+</span> <span class="st">"% var)"</span>)</span>
<span id="cb98-2"><a href="#cb98-2" tabindex="-1"></a>plt.ylabel(<span class="st">"PC 2 ("</span> <span class="op">+</span> <span class="bu">str</span>(<span class="bu">round</span>(pca.explained_variance_ratio_[<span class="dv">1</span>]<span class="op">*</span><span class="dv">100</span>,<span class="dv">1</span>)) <span class="op">+</span> <span class="st">"% var)"</span>)</span>
<span id="cb98-3"><a href="#cb98-3" tabindex="-1"></a>plt.title(<span class="st">"PCA of salary &amp; ordinal variables"</span>)</span>
<span id="cb98-4"><a href="#cb98-4" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb98-5"><a href="#cb98-5" tabindex="-1"></a>plt.show()</span></code></pre>
</div>
<figure><img src="fig/02-data-exploration-and-preprocessing-rendered-unnamed-chunk-54-15.png" width="576" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>This plot shows the first two principal components of the data, with
points coloured by total compensation. The axes represent the directions
of maximum variance in the data.</p>
<p>We can try to understand what those directions are like this:</p>
<div class="codewrapper sourceCode" id="cb99">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" tabindex="-1"></a>pca.components_</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>array([[ 0.55808865,  0.58493097,  0.54763911,  0.02735323,  0.21385984],
       [-0.10224567, -0.14076186, -0.00198261,  0.8150497 ,  0.55264997]])</code></pre>
</div>
<p>The first component consists mostly of the time-based factors. The
second component contains stronger contributions from education and
total compensation.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>Pandas is a powerful library for data manipulation and
analysis.</li>
<li>DataFrames are two-dimensional, labelled data containers that can
contain mixed data types</li>
<li>Series are one-dimensional, labelled data containers that can only
contain a single data type</li>
<li>
<code>loc[]</code> can be used to select combinations of rows and
columns from a DataFrame</li>
<li>Use <code>loc[]</code> to access data by label, or use boolean
masking to select data based on logical conditions</li>
<li>Use <code>astype()</code> to change the data type of a column</li>
<li>Use <code>isna()</code> to find missing values, and
<code>fillna()</code> to fill them</li>
<li>Use <code>dropna()</code> to remove rows or columns with missing
values</li>
<li>Use <code>value_counts()</code> to count occurrences of categorical
variables</li>
<li>Use <code>groupby()</code> to perform calculations on groups of
data</li>
<li>Use <code>map()</code> to apply a function to every element in a
Series</li>
<li>Use <code>OrdinalEncoder()</code> to convert categorical variables
with an implicit order into numeric values</li>
<li>Use <code>corr()</code> to calculate correlations between variables
- but don’t rely on correlations alone!</li>
<li>Use PCA to visualise complex structures in high-dimensional
data</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section><div class="footnotes footnotes-end-of-document">
<hr><ol><li id="fn1"><p><a href="https://www.forbes.com/sites/gilpress/2016/03/23/data-preparation-most-time-consuming-least-enjoyable-data-science-task-survey-says/" class="external-link">Cleaning
Big Data: Most Time-Consuming, Least Enjoyable Data Science Task, Survey
Says. Forbes, 2016</a><a href="#fnref1" class="footnote-back">↩︎</a></p></li>
</ol></div>



      </div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="01-problem-definition.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="04-model-selection.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="01-problem-definition.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Problem Definition
        </a>
        <a class="chapter-link float-end" href="04-model-selection.html" rel="next">
          Next: Machine learning:...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/RSEjas140/AAISS25_html/edit/main/episodes/02-data-exploration-and-preprocessing.Rmd" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/RSEjas140/AAISS25_html/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/RSEjas140/AAISS25_html/" class="external-link">Source</a></p>
				<p><a href="https://github.com/RSEjas140/AAISS25_html/blob/main/CITATION.cff" class="external-link">Cite</a> | <a href="mailto:jas140@aber.ac.uk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/d03c89cd0fa3931a82df26aa15388efab7cf4e9b" class="external-link">sandpaper (0.16.13.9000)</a>, <a href="https://github.com/carpentries/pegboard/tree/5e0d711121a581777d83cf270e298c933f112d52" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.6" class="external-link">varnish (1.0.6)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "LearningResource",
  "@id": "https://RSEjas140.github.io/AAISS25_html/02-data-exploration-and-preprocessing.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/LearningResource/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, The Carpentries",
  "name": "Data exploration and Preprocessing",
  "creativeWorkStatus": "active",
  "url": "https://RSEjas140.github.io/AAISS25_html/02-data-exploration-and-preprocessing.html",
  "identifier": "https://RSEjas140.github.io/AAISS25_html/02-data-exploration-and-preprocessing.html",
  "dateCreated": "2025-07-04",
  "dateModified": "2025-07-08",
  "datePublished": "2025-07-08"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

